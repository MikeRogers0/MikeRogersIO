# Docker Compose 2.4 is for local development
# https://www.heroku.com/podcasts/codeish/57-discussing-docker-containers-and-kubernetes-with-a-docker-captain - Source on that.
version: '2.4'

services:

  web:
    image: mikerogers_io:latest
    mem_limit: 512m
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    volumes:
      - .:/usr/src/app
      - ~/.docker-data/ruby/2.7.1/bundler:/usr/local/bundle:delegated
    command: >
      bash -c "bundle check || bundle install &&
      yarn install --check-files &&
      bundle exec middleman server -p 3001"
    ports:
      - "${PORT:-3001}:3001"
